<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯—å¥æ¶ˆæ¶ˆä¹</title>
    <style>
        body {
            font-family: 'Comic Sans MS', 'Marker Felt', 'å¾®è½¯é›…é»‘', sans-serif;
            background-color: #e3f2fd;
            margin: 0;
            padding: 20px;
            text-align: center;
            color: #2c3e50;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            border: 5px dashed #90caf9;
        }
        
        h1 {
            color: #1976d2;
            text-shadow: 2px 2px 0px #bbdefb;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #5c6bc0;
            margin-bottom: 30px;
            font-size: 1.2em;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px auto;
            max-width: 500px;
        }
        
        .card {
            height: 80px;
            background-color: #bbdefb;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            position: relative;
            perspective: 1000px;
            transform-style: preserve-3d;
        }
        
        .card.flipped {
            transform: rotateY(180deg);
            background-color: #e3f2fd;
        }
        
        .card.matched {
            background-color: #a5d6a7;
            cursor: default;
        }
        
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
        }
        
        .card-front {
            background-color: #bbdefb;
            transform: rotateY(0deg);
        }
        
        .card-back {
            background-color: #e3f2fd;
            transform: rotateY(180deg);
        }
        
        .game-info {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .info-box {
            background-color: #e3f2fd;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 18px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .controls {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        button {
            background-color: #42a5f5;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            font-family: 'Comic Sans MS', 'Marker Felt', 'å¾®è½¯é›…é»‘', sans-serif;
        }
        
        button:hover {
            background-color: #1e88e5;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .settings {
            margin-top: 30px;
            padding: 20px;
            background-color: #e3f2fd;
            border-radius: 10px;
            border: 3px dotted #90caf9;
            text-align: left;
        }
        
        .settings-title {
            font-size: 20px;
            color: #1976d2;
            margin-bottom: 15px;
            text-align: center;
        }
        
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #90caf9;
            font-family: 'Comic Sans MS', 'Marker Felt', 'å¾®è½¯é›…é»‘', sans-serif;
            font-size: 16px;
            margin-bottom: 10px;
            resize: vertical;
        }
        
        .player-input {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        input {
            padding: 10px 15px;
            border-radius: 50px;
            border: 2px solid #90caf9;
            font-family: 'Comic Sans MS', 'Marker Felt', 'å¾®è½¯é›…é»‘', sans-serif;
            font-size: 16px;
            outline: none;
        }
        
        input:focus {
            border-color: #42a5f5;
        }
        
        .leaderboard {
            margin-top: 30px;
            padding: 20px;
            background-color: #e3f2fd;
            border-radius: 10px;
            border: 3px dotted #90caf9;
        }
        
        .leaderboard-title {
            font-size: 20px;
            color: #1976d2;
            margin-bottom: 15px;
            text-align: center;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #bbdefb;
        }
        
        th {
            background-color: #bbdefb;
            color: #0d47a1;
        }
        
        tr:nth-child(even) {
            background-color: #e1f5fe;
        }
        
        tr:hover {
            background-color: #b3e5fc;
        }
        
        .export-btn {
            margin-top: 15px;
            background-color: #5c6bc0;
        }
        
        .export-btn:hover {
            background-color: #3949ab;
        }
        
        .poem-preview {
            margin-top: 20px;
            padding: 15px;
            background-color: #e1f5fe;
            border-radius: 10px;
            font-size: 18px;
            line-height: 1.6;
        }
        
        @media (max-width: 600px) {
            .game-board {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .card {
                height: 70px;
                font-size: 20px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .player-input {
                flex-direction: column;
            }
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes flip {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(180deg); }
        }
        
        @keyframes match {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .matched {
            animation: match 0.5s;
        }
        
        .flipped {
            animation: flip 0.5s forwards;
        }
        
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(500px) rotate(360deg); opacity: 0; }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            z-index: 10;
            animation: confetti 2s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“œ è¯—å¥æ¶ˆæ¶ˆä¹ ğŸ“œ</h1>
        <div class="subtitle">åŒ¹é…è¯—å¥ä¸Šä¸‹è”ï¼ŒæŒ‘æˆ˜æœ€å¿«æ—¶é—´ï¼</div>
        
        <div class="game-area">
            <div class="player-input">
                <input type="text" id="playerName" placeholder="è¾“å…¥ä½ çš„åå­—" required>
                <button id="startBtn">å¼€å§‹æ¸¸æˆ</button>
            </div>
            
            <div class="game-info">
                <div class="info-box">æ—¶é—´: <span id="timer">00:00</span></div>
                <div class="info-box">åŒ¹é…: <span id="matches">0</span> / <span id="totalPairs">0</span></div>
                <div class="info-box">å°è¯•: <span id="attempts">0</span></div>
            </div>
            
            <div class="game-board" id="gameBoard">
                <!-- æ¸¸æˆå¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="poem-preview" id="poemPreview">
                æ¸¸æˆå¼€å§‹åä¼šæ˜¾ç¤ºè¯—å¥é¢„è§ˆ
            </div>
            
            <div class="controls">
                <button id="newGameBtn" disabled>æ–°æ¸¸æˆ</button>
                <button id="settingsBtn">è¯—å¥è®¾ç½®</button>
                <button id="leaderboardBtn">æ’è¡Œæ¦œ</button>
            </div>
        </div>
        
        <div class="settings" id="settingsPanel" style="display: none;">
            <div class="settings-title">ğŸ–‹ï¸ è¯—å¥è®¾ç½®</div>
            <p>æ¯è¡Œè¾“å…¥ä¸€å¥è¯—ï¼Œä¸Šä¸‹è”è¯—å¥ä¼šè‡ªåŠ¨é…å¯¹ï¼š</p>
            <textarea id="poemsInput" placeholder="ä¾‹å¦‚ï¼š
åºŠå‰æ˜æœˆå…‰
ç–‘æ˜¯åœ°ä¸Šéœœ
æ˜¥çœ ä¸è§‰æ™“
å¤„å¤„é—»å•¼é¸Ÿ"></textarea>
            <button id="savePoemsBtn">ä¿å­˜è¯—å¥</button>
            <button id="defaultPoemsBtn">æ¢å¤é»˜è®¤è¯—å¥</button>
        </div>
        
        <div class="leaderboard" id="leaderboardPanel" style="display: none;">
            <div class="leaderboard-title">ğŸ† æ’è¡Œæ¦œ</div>
            <table id="leaderboardTable">
                <thead>
                    <tr>
                        <th>æ’å</th>
                        <th>å§“å</th>
                        <th>æ—¶é—´</th>
                        <th>æ—¥æœŸ</th>
                    </tr>
                </thead>
                <tbody id="leaderboardBody">
                    <!-- æ’è¡Œæ¦œå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </tbody>
            </table>
            <button class="export-btn" id="exportLeaderboardBtn">å¯¼å‡ºæ’è¡Œæ¦œ</button>
        </div>
    </div>

    <audio id="flipSound" src="https://www.soundjay.com/mechanical/sounds/card-flip-01.mp3" preload="auto"></audio>
    <audio id="matchSound" src="https://www.soundjay.com/buttons/sounds/button-09.mp3" preload="auto"></audio>
    <audio id="winSound" src="https://www.soundjay.com/human/sounds/applause-8.mp3" preload="auto"></audio>

    <script>
        // é»˜è®¤è¯—å¥æ•°æ®
        const defaultPoems = [
            "åºŠå‰æ˜æœˆå…‰", "ç–‘æ˜¯åœ°ä¸Šéœœ",
            "æ˜¥çœ ä¸è§‰æ™“", "å¤„å¤„é—»å•¼é¸Ÿ",
            "ç™½æ—¥ä¾å±±å°½", "é»„æ²³å…¥æµ·æµ",
            "çº¢è±†ç”Ÿå—å›½", "æ˜¥æ¥å‘å‡ æ",
            "é”„ç¦¾æ—¥å½“åˆ", "æ±—æ»´ç¦¾ä¸‹åœŸ",
            "ç¦»ç¦»åŸä¸Šè‰", "ä¸€å²ä¸€æ¯è£",
            "ç©ºå±±ä¸è§äºº", "ä½†é—»äººè¯­å“",
            "åƒå±±é¸Ÿé£ç»", "ä¸‡å¾„äººè¸ªç­",
            "æ…ˆæ¯æ‰‹ä¸­çº¿", "æ¸¸å­èº«ä¸Šè¡£",
            "å›½ç ´å±±æ²³åœ¨", "åŸæ˜¥è‰æœ¨æ·±"
        ];
        
        // æ¸¸æˆçŠ¶æ€
        let poems = JSON.parse(localStorage.getItem('poemMemoryGamePoems')) || [...defaultPoems];
        let leaderboard = JSON.parse(localStorage.getItem('poemMemoryGameLeaderboard')) || [];
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let attempts = 0;
        let timer = null;
        let seconds = 0;
        let gameStarted = false;
        let currentPlayer = '';
        
        // DOMå…ƒç´ 
        const gameBoard = document.getElementById('gameBoard');
        const timerDisplay = document.getElementById('timer');
        const matchesDisplay = document.getElementById('matches');
        const totalPairsDisplay = document.getElementById('totalPairs');
        const attemptsDisplay = document.getElementById('attempts');
        const playerNameInput = document.getElementById('playerName');
        const startBtn = document.getElementById('startBtn');
        const newGameBtn = document.getElementById('newGameBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const leaderboardBtn = document.getElementById('leaderboardBtn');
        const settingsPanel = document.getElementById('settingsPanel');
        const leaderboardPanel = document.getElementById('leaderboardPanel');
        const poemsInput = document.getElementById('poemsInput');
        const savePoemsBtn = document.getElementById('savePoemsBtn');
        const defaultPoemsBtn = document.getElementById('defaultPoemsBtn');
        const leaderboardBody = document.getElementById('leaderboardBody');
        const exportLeaderboardBtn = document.getElementById('exportLeaderboardBtn');
        const poemPreview = document.getElementById('poemPreview');
        const flipSound = document.getElementById('flipSound');
        const matchSound = document.getElementById('matchSound');
        const winSound = document.getElementById('winSound');
        
        // åˆå§‹åŒ–
        function init() {
            renderPoemPreview();
            renderLeaderboard();
            
            // äº‹ä»¶ç›‘å¬
            startBtn.addEventListener('click', startGame);
            newGameBtn.addEventListener('click', setupGame);
            settingsBtn.addEventListener('click', toggleSettings);
            leaderboardBtn.addEventListener('click', toggleLeaderboard);
            savePoemsBtn.addEventListener('click', savePoems);
            defaultPoemsBtn.addEventListener('click', restoreDefaultPoems);
            exportLeaderboardBtn.addEventListener('click', exportLeaderboard);
            
            // åˆå§‹åŒ–è¯—å¥è¾“å…¥æ¡†
            poemsInput.value = poems.join('\n');
        }
        
        // æ¸²æŸ“è¯—å¥é¢„è§ˆ
        function renderPoemPreview() {
            let previewHTML = '';
            
            // å°†è¯—å¥åˆ†æˆä¸Šä¸‹è”
            for (let i = 0; i < poems.length; i += 2) {
                if (i + 1 < poems.length) {
                    previewHTML += `<div>${poems[i]} â€”â€” ${poems[i+1]}</div>`;
                } else {
                    previewHTML += `<div>${poems[i]}</div>`;
                }
            }
            
            poemPreview.innerHTML = previewHTML || 'æš‚æ— è¯—å¥ï¼Œè¯·å…ˆè®¾ç½®è¯—å¥';
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            const playerName = playerNameInput.value.trim();
            if (!playerName) {
                alert('è¯·è¾“å…¥ä½ çš„åå­—ï¼');
                return;
            }
            
            currentPlayer = playerName;
            playerNameInput.disabled = true;
            startBtn.disabled = true;
            
            setupGame();
        }
        
        // è®¾ç½®æ¸¸æˆ
        function setupGame() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            clearInterval(timer);
            seconds = 0;
            matchedPairs = 0;
            attempts = 0;
            flippedCards = [];
            gameStarted = false;
            
            // æ›´æ–°UI
            updateTimer();
            matchesDisplay.textContent = matchedPairs;
            attemptsDisplay.textContent = attempts;
            
            // åˆ›å»ºå¡ç‰‡
            createCards();
            
            // å¯ç”¨æ–°æ¸¸æˆæŒ‰é’®
            newGameBtn.disabled = false;
        }
        
        // åˆ›å»ºå¡ç‰‡
        function createCards() {
            gameBoard.innerHTML = '';
            cards = [];
            
            // ç¡®ä¿è¯—å¥æ•°é‡æ˜¯å¶æ•°
            const usablePoems = [...poems];
            if (usablePoems.length % 2 !== 0) {
                usablePoems.pop(); // å¦‚æœæ˜¯å¥‡æ•°ï¼Œå»æ‰æœ€åä¸€ä¸ª
            }
            
            // éšæœºé€‰æ‹©8å¯¹è¯—å¥(16å¼ å¡ç‰‡)
            const selectedPoems = [];
            while (selectedPoems.length < 16 && usablePoems.length > 0) {
                const randomIndex = Math.floor(Math.random() * usablePoems.length);
                const poem = usablePoems.splice(randomIndex, 1)[0];
                selectedPoems.push(poem);
                
                // å¦‚æœæ˜¯å¶æ•°ç´¢å¼•ï¼Œæ·»åŠ ä¸‹è”
                if (randomIndex % 2 === 0 && randomIndex + 1 < usablePoems.length) {
                    selectedPoems.push(usablePoems[randomIndex]);
                    usablePoems.splice(randomIndex, 1);
                }
            }
            
            // å¦‚æœè¯—å¥ä¸å¤Ÿï¼Œéšæœºå¤åˆ¶ä¸€äº›
            while (selectedPoems.length < 16) {
                const randomPoem = poems[Math.floor(Math.random() * poems.length)];
                selectedPoems.push(randomPoem);
                selectedPoems.push(randomPoem);
            }
            
            // æ‰“ä¹±é¡ºåº
            shuffleArray(selectedPoems);
            
            // åˆ›å»ºå¡ç‰‡
            selectedPoems.forEach((poem, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.index = index;
                card.dataset.poem = poem;
                
                const cardFront = document.createElement('div');
                cardFront.className = 'card-face card-front';
                cardFront.textContent = 'â“';
                
                const cardBack = document.createElement('div');
                cardBack.className = 'card-face card-back';
                cardBack.textContent = poem;
                
                card.appendChild(cardFront);
                card.appendChild(cardBack);
                
                card.addEventListener('click', () => flipCard(card));
                gameBoard.appendChild(card);
                
                cards.push({
                    element: card,
                    poem: poem,
                    matched: false
                });
            });
            
            // æ›´æ–°æ€»å¯¹æ•°æ˜¾ç¤º
            totalPairsDisplay.textContent = selectedPoems.length / 2;
        }
        
        // ç¿»è½¬å¡ç‰‡
        function flipCard(card) {
            // å¦‚æœæ¸¸æˆæœªå¼€å§‹ï¼Œå¼€å§‹è®¡æ—¶
            if (!gameStarted) {
                startTimer();
                gameStarted = true;
            }
            
            const index = parseInt(card.dataset.index);
            const cardObj = cards[index];
            
            // å¦‚æœå¡ç‰‡å·²åŒ¹é…æˆ–å·²ç¿»è½¬ï¼Œå¿½ç•¥
            if (cardObj.matched || flippedCards.includes(index) || flippedCards.length >= 2) {
                return;
            }
            
            // æ’­æ”¾ç¿»è½¬éŸ³æ•ˆ
            flipSound.currentTime = 0;
            flipSound.play();
            
            // ç¿»è½¬å¡ç‰‡
            card.classList.add('flipped');
            flippedCards.push(index);
            
            // å¦‚æœç¿»è½¬äº†ä¸¤å¼ å¡ç‰‡ï¼Œæ£€æŸ¥æ˜¯å¦åŒ¹é…
            if (flippedCards.length === 2) {
                attempts++;
                attemptsDisplay.textContent = attempts;
                
                const card1 = cards[flippedCards[0]];
                const card2 = cards[flippedCards[1]];
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯ä¸Šä¸‹è”
                const poem1 = card1.poem;
                const poem2 = card2.poem;
                let isPair = false;
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯é»˜è®¤é…å¯¹
                for (let i = 0; i < poems.length; i += 2) {
                    if ((poem1 === poems[i] && poem2 === poems[i+1]) || 
                        (poem1 === poems[i+1] && poem2 === poems[i])) {
                        isPair = true;
                        break;
                    }
                }
                
                // å¦‚æœä¸æ˜¯é»˜è®¤é…å¯¹ï¼Œæ£€æŸ¥æ˜¯å¦ç›¸åŒ
                if (!isPair && poem1 === poem2) {
                    isPair = true;
                }
                
                if (isPair) {
                    // åŒ¹é…æˆåŠŸ
                    setTimeout(() => {
                        card1.element.classList.add('matched');
                        card2.element.classList.add('matched');
                        card1.matched = true;
                        card2.matched = true;
                        
                        // æ’­æ”¾åŒ¹é…éŸ³æ•ˆ
                        matchSound.play();
                        
                        matchedPairs++;
                        matchesDisplay.textContent = matchedPairs;
                        
                        // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                        if (matchedPairs === parseInt(totalPairsDisplay.textContent)) {
                            endGame();
                        }
                        
                        flippedCards = [];
                    }, 500);
                } else {
                    // ä¸åŒ¹é…ï¼Œç¿»å›å»
                    setTimeout(() => {
                        cards[flippedCards[0]].element.classList.remove('flipped');
                        cards[flippedCards[1]].element.classList.remove('flipped');
                        flippedCards = [];
                    }, 1000);
                }
            }
        }
        
        // å¼€å§‹è®¡æ—¶
        function startTimer() {
            clearInterval(timer);
            seconds = 0;
            updateTimer();
            
            timer = setInterval(() => {
                seconds++;
                updateTimer();
            }, 1000);
        }
        
        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimer() {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        // ç»“æŸæ¸¸æˆ
        function endGame() {
            clearInterval(timer);
            
            // æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
            winSound.play();
            
            // æ·»åŠ åº†ç¥æ•ˆæœ
            createConfetti();
            
            // æ·»åŠ åˆ°æ’è¡Œæ¦œ
            addToLeaderboard();
            
            alert(`æ­å–œ ${currentPlayer} å®Œæˆæ¸¸æˆï¼\nç”¨æ—¶: ${timerDisplay.textContent}\nå°è¯•æ¬¡æ•°: ${attempts}`);
        }
        
        // æ·»åŠ åˆ°æ’è¡Œæ¦œ
        function addToLeaderboard() {
            const now = new Date();
            const timestamp = now.toLocaleString();
            
            leaderboard.push({
                player: currentPlayer,
                time: seconds,
                timestamp: timestamp
            });
            
            // æŒ‰æ—¶é—´æ’åº
            leaderboard.sort((a, b) => a.time - b.time);
            
            // é™åˆ¶æ’è¡Œæ¦œæ•°é‡
            if (leaderboard.length > 20) {
                leaderboard.pop();
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('poemMemoryGameLeaderboard', JSON.stringify(leaderboard));
            
            // æ›´æ–°æ’è¡Œæ¦œæ˜¾ç¤º
            renderLeaderboard();
        }
        
        // æ¸²æŸ“æ’è¡Œæ¦œ
        function renderLeaderboard() {
            leaderboardBody.innerHTML = '';
            
            leaderboard.forEach((entry, index) => {
                const minutes = Math.floor(entry.time / 60);
                const seconds = entry.time % 60;
                const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${entry.player}</td>
                    <td>${timeString}</td>
                    <td>${entry.timestamp}</td>
                `;
                leaderboardBody.appendChild(row);
            });
        }
        
        // åˆ‡æ¢è®¾ç½®é¢æ¿
        function toggleSettings() {
            settingsPanel.style.display = settingsPanel.style.display === 'none' ? 'block' : 'none';
            leaderboardPanel.style.display = 'none';
            
            // æ›´æ–°è¯—å¥è¾“å…¥æ¡†
            poemsInput.value = poems.join('\n');
        }
        
        // åˆ‡æ¢æ’è¡Œæ¦œé¢æ¿
        function toggleLeaderboard() {
            leaderboardPanel.style.display = leaderboardPanel.style.display === 'none' ? 'block' : 'none';
            settingsPanel.style.display = 'none';
        }
        
        // ä¿å­˜è¯—å¥
        function savePoems() {
            const poemLines = poemsInput.value.split('\n').map(line => line.trim()).filter(line => line);
            
            if (poemLines.length < 4) {
                alert('è¯·è‡³å°‘è¾“å…¥4å¥è¯—ï¼ˆ2å¯¹ï¼‰ï¼');
                return;
            }
            
            poems = poemLines;
            localStorage.setItem('poemMemoryGamePoems', JSON.stringify(poems));
            
            alert('è¯—å¥è®¾ç½®å·²ä¿å­˜ï¼');
            renderPoemPreview();
            toggleSettings();
        }
        
        // æ¢å¤é»˜è®¤è¯—å¥
        function restoreDefaultPoems() {
            if (confirm('ç¡®å®šè¦æ¢å¤é»˜è®¤è¯—å¥å—ï¼Ÿå½“å‰è¯—å¥å°†è¢«æ›¿æ¢ã€‚')) {
                poems = [...defaultPoems];
                poemsInput.value = poems.join('\n');
                localStorage.setItem('poemMemoryGamePoems', JSON.stringify(poems));
                renderPoemPreview();
            }
        }
        
        // å¯¼å‡ºæ’è¡Œæ¦œ
        function exportLeaderboard() {
            if (leaderboard.length === 0) {
                alert('æ’è¡Œæ¦œä¸ºç©ºï¼Œæ²¡æœ‰æ•°æ®å¯å¯¼å‡ºï¼');
                return;
            }
            
            let csv = 'æ’å,å§“å,æ—¶é—´(ç§’),æ—¥æœŸ\n';
            
            leaderboard.forEach((entry, index) => {
                csv += `${index + 1},${entry.player},${entry.time},${entry.timestamp}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `è¯—å¥æ¶ˆæ¶ˆä¹æ’è¡Œæ¦œ_${new Date().toLocaleDateString()}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // åˆ›å»ºå½©è‰²çº¸å±‘æ•ˆæœ
        function createConfetti() {
            const colors = ['#ff9ff3', '#feca57', '#ff6b6b', '#48dbfb', '#1dd1a1', '#f368e0'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                
                document.body.appendChild(confetti);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤
                setTimeout(() => {
                    confetti.remove();
                }, 2000);
            }
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šæ‰“ä¹±æ•°ç»„
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        init();
    </script>
</body>
</html>